import SwiftUI
import SpriteKit

struct ContentView: View {
    var scene: SKScene {
        let scene = GameScene()
        scene.size = CGSize(width: UIScreen.main.bounds.width, height: UIScreen.main.bounds.height)
        scene.scaleMode = .resizeFill
        return scene
    }

    var body: some View {
        SpriteView(scene: scene)
            .ignoresSafeArea()
    }
}

class GameScene: SKScene {
    var scoreLabel: SKLabelNode!
    var ball: SKSpriteNode!
    var score = 0

    override func didMove(to view: SKView) {
        backgroundColor = .blue

        scoreLabel = SKLabelNode(fontNamed: "AvenirNext-Bold")
        scoreLabel.fontSize = 36
        scoreLabel.fontColor = .white
        scoreLabel.position = CGPoint(x: frame.midX, y: frame.maxY - 80)
        scoreLabel.text = "Score: 0"
        addChild(scoreLabel)

        spawnBall()
    }

    func spawnBall() {
        ball = SKSpriteNode(color: .red, size: CGSize(width: 60, height: 60))
        ball.position = CGPoint(x: CGFloat.random(in: 60...(frame.width - 60)), y: frame.maxY + 60)
        addChild(ball)

        let moveDown = SKAction.moveTo(y: -60, duration: 4)
        let remove = SKAction.removeFromParent()
        let sequence = SKAction.sequence([moveDown, remove])
        ball.run(sequence) {
            self.spawnBall()
        }
    }

    override func touchesBegan(_ touches: Set<UITouch>, with event: UIEvent?) {
        guard let touch = touches.first else { return }
        let location = touch.location(in: self)

        if ball.contains(location) {
            ball.removeFromParent()
            score += 1
            scoreLabel.text = "Score: \(score)"
            spawnBall()
        }
    }
}