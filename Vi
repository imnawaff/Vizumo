import SwiftUI
import SpriteKit

// 1. SpriteKit Game Scene
class GameScene: SKScene {
    let player = SKSpriteNode(color: .cyan, size: CGSize(width: 50, height: 50))
    
    override func didMove(to view: SKView) {
        backgroundColor = .black
        
        player.position = CGPoint(x: size.width / 2, y: 100)
        addChild(player)
        
        // Spawn bullets when screen is tapped
        let tapRecognizer = UITapGestureRecognizer(target: self, action: #selector(fireBullet))
        view.addGestureRecognizer(tapRecognizer)
    }

    @objc func fireBullet() {
        let bullet = SKSpriteNode(color: .green, size: CGSize(width: 5, height: 20))
        bullet.position = CGPoint(x: player.position.x, y: player.position.y + 30)
        addChild(bullet)

        let moveUp = SKAction.moveBy(x: 0, y: size.height, duration: 1.0)
        let remove = SKAction.removeFromParent()
        bullet.run(SKAction.sequence([moveUp, remove]))
    }

    override func touchesMoved(_ touches: Set<UITouch>, with event: UIEvent?) {
        if let touch = touches.first {
            let location = touch.location(in: self)
            player.position.x = location.x
        }
    }
}

// 2. SwiftUI View that shows the SpriteKit scene
struct ContentView: View {
    var scene: SKScene {
        let scene = GameScene()
        scene.size = CGSize(width: 400, height: 600)
        scene.scaleMode = .resizeFill
        return scene
    }

    var body: some View {
        SpriteView(scene: scene)
            .frame(width: 400, height: 600)
            .ignoresSafeArea()
    }
}